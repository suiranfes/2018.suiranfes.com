/*! pjax-api v3.20.1 https://github.com/falsandtru/pjax-api | (c) 2018, falsandtru | (Apache-2.0 AND MPL-2.0) License */
require=function e(t,n,r){function s(o,c){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!c&&u)return u(o,!0);if(i)return i(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,n){},{}],2:[function(e,t,n){arguments[4][1][0].apply(n,arguments)},{dup:1}],3:[function(e,t,n){var r,s,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function u(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{s="function"==typeof clearTimeout?clearTimeout:c}catch(e){s=c}}();var a,l=[],d=!1,h=-1;function f(){d&&a&&(d=!1,a.length?l=a.concat(l):h=-1,l.length&&p())}function p(){if(!d){var e=u(f);d=!0;for(var t=l.length;t;){for(a=l,l=[];++h<t;)a&&a[h].run();h=-1,t=l.length}a=null,d=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===c||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new m(e,t)),1!==l.length||d||u(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./type");function s(e){return function(t,...n){if(void 0===t||null===t)throw new TypeError(`Spica: assign: Cannot walk on ${t}.`);for(const r of n)if(void 0!==r&&null!==r)for(const n of Object.keys(Object(r))){const s=Object.getOwnPropertyDescriptor(Object(r),n);void 0!==s&&s.enumerable&&e(n,Object(t),Object(r))}return Object(t)}}n.assign=s((e,t,n)=>t[e]=n[e]),n.clone=s((e,t,s)=>{switch(r.type(s[e])){case"Array":return t[e]=n.clone([],s[e]);case"Object":return t[e]=s[e]instanceof Object?n.clone({},s[e]):s[e];default:return t[e]=s[e]}}),n.extend=s((e,t,s)=>{switch(r.type(s[e])){case"Array":return t[e]=n.extend([],s[e]);case"Object":switch(r.type(t[e])){case"Object":return t[e]=s[e]instanceof Object?n.extend(t[e],s[e]):s[e];default:return t[e]=s[e]instanceof Object?n.extend({},s[e]):s[e]}default:return t[e]=s[e]}})},{"./type":79}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./assign"),s=e("./equal");n.Cache=class{constructor(e,t=(()=>void 0),n={}){if(this.size=e,this.callback=t,this.opts={ignore:{delete:!1,clear:!1}},e>0==0)throw new Error("Spica: Cache: Cache size must be greater than 0.");Object.freeze(r.extend(this.opts,n));const{stats:s,entries:i}=n.data||{stats:[[],[]],entries:[]},o=s[1].slice(0,e),c=s[0].slice(0,e-o.length);if(this.stats={LRU:c,LFU:o},this.store=new Map(i),[...s[1],...s[0]].slice(o.length+c.length).forEach(e=>void this.store.delete(e)),this.store.size!==o.length+c.length)throw new Error("Spica: Cache: Size of stats and entries is not matched.");if(![...o,...c].every(e=>this.store.has(e)))throw new Error("Spica: Cache: Keys of stats and entries is not matched.")}put(e,t,n=!0){if(!n&&this.store.has(e))return this.store.set(e,t),!0;if(this.access(e))return this.store.set(e,t),!0;const{LRU:r,LFU:s}=this.stats;if(r.length+s.length===this.size&&r.length<s.length){const e=s.pop(),t=this.store.get(e);this.store.delete(e),this.callback(e,t)}if(r.unshift(e),this.store.set(e,t),r.length+s.length>this.size){const e=r.pop(),t=this.store.get(e);this.store.delete(e),this.callback(e,t)}return!1}set(e,t,n){return this.put(e,t,n),t}get(e,t=!0){return t?(this.access(e),this.store.get(e)):this.store.get(e)}has(e){return this.store.has(e)}delete(e){if(!this.store.has(e))return!1;const{LRU:t,LFU:n}=this.stats;for(const r of[n,t]){const t=s.findIndex(e,r);if(-1===t)continue;const n=this.store.get(e);return this.store.delete(r.splice(t,1)[0]),!!this.opts.ignore.delete||(this.callback(e,n),!0)}return!1}clear(){const e=this.store;this.store=new Map,this.stats={LRU:[],LFU:[]},this.opts.ignore.clear||[...e].forEach(([e,t])=>void this.callback(e,t))}[Symbol.iterator](){return this.store[Symbol.iterator]()}export(){return{stats:[this.stats.LRU.slice(),this.stats.LFU.slice()],entries:[...this]}}inspect(){const{LRU:e,LFU:t}=this.stats;return[e.slice(),t.slice()]}access(e){return this.accessLFU(e)||this.accessLRU(e)}accessLRU(e){if(!this.store.has(e))return!1;const{LRU:t}=this.stats,n=s.findIndex(e,t);if(-1===n)return!1;const{LFU:r}=this.stats;return r.unshift(...t.splice(n,1)),!0}accessLFU(e){if(!this.store.has(e))return!1;const{LFU:t}=this.stats,n=s.findIndex(e,t);return-1!==n&&(t.unshift(...t.splice(n,1)),!0)}}},{"./assign":4,"./equal":11}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./exception"),s=e("./monad/maybe"),i=e("./monad/either");n.Cancellation=class{constructor(e=[]){this.done=!1,this.listeners=new Set,this.register=(e=>{return this.canceled?(t(this.reason),()=>void 0):this.done?()=>void 0:(this.listeners.add(t),()=>this.done?void 0:void this.listeners.delete(t));function t(t){try{e(t)}catch(t){r.causeAsyncException(t)}}}),this.cancel=(e=>{this.done||(this.done=!0,this.canceled=!0,this.reason=e,Object.freeze(this.listeners),Object.freeze(this),this.listeners.forEach(t=>void t(e)))}),this.close=(()=>{this.done||(this.done=!0,Object.freeze(this.listeners),Object.freeze(this))}),this.canceled=!1,this.promise=(e=>this.canceled?new Promise((e,t)=>void t(this.reason)):Promise.resolve(e)),this.maybe=(e=>this.canceled?s.Nothing:s.Just(e)),this.either=(e=>this.canceled?i.Left(this.reason):i.Right(e)),[...e].forEach(e=>void e.register(this.cancel))}}},{"./exception":12,"./monad/either":18,"./monad/maybe":22}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.compose=function(e,...t){return t.reduce((e,t)=>(Object.getOwnPropertyNames(t.prototype).filter(t=>!(t in e.prototype)).forEach(n=>e.prototype[n]=t.prototype[n]),Object.getOwnPropertyNames(t).filter(t=>!(t in e)).forEach(n=>e[n]=t[n]),e),e)}},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.concat=function(e,t){for(let n=0,r=e.length,s=t.length;n<s;++n)e[r+n]=t[n];return e}},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.curry=((e,t)=>0===e.length?()=>e.call(t):function e(t,n,r){return t.length<=n.length?t.apply(r,n.slice(0,t.length)):(...s)=>e(t,n.concat(s),r)}(e,[],t))},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./monad/either"))},{"./monad/either":18}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.findIndex=function(e,t){const n=e!=e;for(let r=0;r<t.length;++r){const s=t[r];if(n?s!=s:s===e)return r}return-1}},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.causeAsyncException=function(e){new Promise((t,n)=>void n(e))}},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./curry");n.flip=function(e){return r.curry((t,n)=>e.length>1?e(n,t):e(n)(t))}},{"./curry":9}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./concat");class s{constructor(){this.NIL}push(e){return new i(e,this)}extend(e){return this.push(e())}array(){return[]}}n.HNil=s;class i{constructor(e,t){this.head=e,this.tail=t,this.CONS}push(e){return new i(e,this)}walk(e){return e(this.head),this.tail}modify(e){return this.tail.push(e(this.head))}extend(e){return this.push(e(this.head))}compact(e){return this.tail.modify(t=>e(this.head,t))}reverse(){return this.array().reduce((e,t)=>e.push(t),new s)}tuple(){return this.array()}array(){return r.concat([this.head],this.tail.array())}}},{"./concat":8}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./monad/maybe"))},{"./monad/maybe":22}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./functor"),s=e("../curry");class i extends r.Functor{}n.Applicative=i,function(e){(i=n.Applicative||(n.Applicative={})).ap=function e(t,n){return n?t.bind(e=>n.fmap(t=>0===e.length?e(t):s.curry(e)(t))):n=>e(t,n)}}()},{"../curry":9,"./functor":19}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./monad");class s extends r.Monad{constructor(e){super(e),this.EITHER}fmap(e){return this.bind(t=>new o(e(t)))}ap(e){return s.ap(this,e)}bind(e){return new s(()=>{const t=this.evaluate();if(t instanceof i)return t;if(t instanceof o)return e(t.extract());if(t instanceof s)return t.bind(e);throw new TypeError(`Spica: Either: Invalid monad value.\n\t${t}`)})}join(){return this.bind(e=>e)}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}}n.Either=s,function(e){function t(e){return new o(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t.reduce((e,t)=>e.bind(e=>t.fmap(t=>e.concat([t]))),e.Return([]))}}(s=n.Either||(n.Either={}));class i extends s{constructor(e){super(c),this.a=e,this.LEFT}bind(e){return this}extract(e){if(!e)throw this.a;return e(this.a)}}n.Left=i;class o extends s{constructor(e){super(c),this.b=e,this.RIGHT}bind(e){return new s(()=>e(this.extract()))}extract(e,t){return t?t(this.b):this.b}}function c(){throw new Error("Spica: Either: Invalid thunk call.")}n.Right=o},{"./monad":23}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./either.impl");var s;(s=n.Either||(n.Either={})).fmap=r.Either.fmap,s.pure=r.Either.pure,s.ap=r.Either.ap,s.Return=r.Either.Return,s.bind=r.Either.bind,s.sequence=r.Either.sequence,n.Left=function(e){return new r.Left(e)},n.Right=function(e){return new r.Right(e)}},{"./either.impl":17}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./lazy");class s extends r.Lazy{}n.Functor=s,function(e){(s=n.Functor||(n.Functor={})).fmap=function(e,t){return t?e.fmap(t):t=>e.fmap(t)}}()},{"./lazy":20}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Lazy=class{constructor(e){this.thunk=e}evaluate(){return this.memory_=this.memory_||this.thunk()}}},{}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./monadplus");class s extends r.MonadPlus{constructor(e){super(e),this.MAYBE}fmap(e){return this.bind(t=>new i(e(t)))}ap(e){return s.ap(this,e)}bind(e){return new s(()=>{const t=this.evaluate();if(t instanceof i)return e(t.extract());if(t instanceof o)return t;if(t instanceof s)return t.bind(e);throw new TypeError(`Spica: Maybe: Invalid monad value.\n\t${t}`)})}guard(e){return e?this:s.mzero}join(){return this.bind(e=>e)}extract(e,t){return t?this.fmap(t).extract(e):this.evaluate().extract(e)}}n.Maybe=s,function(e){function t(e){return new i(e)}e.pure=t,e.Return=t,e.sequence=function(t){return t.reduce((e,t)=>e.bind(e=>t.fmap(t=>e.concat([t]))),e.Return([]))}}(s=n.Maybe||(n.Maybe={}));class i extends s{constructor(e){super(c),this.a=e,this.JUST}bind(e){return new s(()=>e(this.extract()))}extract(e,t){return t?t(this.a):this.a}}n.Just=i;class o extends s{constructor(){super(c),this.NOTHING}bind(e){return this}extract(e){if(!e)throw void 0;return e()}}function c(){throw new Error("Spica: Maybe: Invalid thunk call.")}n.Nothing=o,function(e){e.mzero=new o,e.mplus=function(t,n){return new e(()=>t.fmap(()=>t).extract(()=>n))}}(s=n.Maybe||(n.Maybe={}))},{"./monadplus":24}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./maybe.impl");var s;(s=n.Maybe||(n.Maybe={})).fmap=r.Maybe.fmap,s.pure=r.Maybe.pure,s.ap=r.Maybe.ap,s.Return=r.Maybe.Return,s.bind=r.Maybe.bind,s.sequence=r.Maybe.sequence,s.mzero=r.Maybe.mzero,s.mplus=r.Maybe.mplus,n.Just=function(e){return new r.Just(e)},n.Nothing=r.Maybe.mzero},{"./maybe.impl":21}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./applicative");class s extends r.Applicative{}n.Monad=s,function(e){(s=n.Monad||(n.Monad={})).bind=function e(t,n){return n?t.bind(n):n=>e(t,n)}}()},{"./applicative":16}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./monad");class s extends r.Monad{}n.MonadPlus=s,s=n.MonadPlus||(n.MonadPlus={})},{"./monad":23}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./sequence/core");n.Sequence=r.Sequence;const s=e("./sequence/member/static/resume"),i=e("./sequence/member/static/from"),o=e("./sequence/member/static/cycle"),c=e("./sequence/member/static/random"),u=e("./sequence/member/static/concat"),a=e("./sequence/member/static/zip"),l=e("./sequence/member/static/difference"),d=e("./sequence/member/static/union"),h=e("./sequence/member/static/intersect"),f=e("./sequence/member/static/pure"),p=e("./sequence/member/static/return"),m=e("./sequence/member/static/sequence"),v=e("./sequence/member/static/mempty"),b=e("./sequence/member/static/mconcat"),y=e("./sequence/member/static/mappend"),w=e("./sequence/member/static/mzero"),q=e("./sequence/member/static/mplus"),S=e("./sequence/member/instance/extract"),g=e("./sequence/member/instance/iterate"),_=e("./sequence/member/instance/memoize"),x=e("./sequence/member/instance/reduce"),E=e("./sequence/member/instance/take"),T=e("./sequence/member/instance/drop"),j=e("./sequence/member/instance/takeWhile"),O=e("./sequence/member/instance/dropWhile"),M=e("./sequence/member/instance/takeUntil"),P=e("./sequence/member/instance/dropUntil"),k=e("./sequence/member/instance/sort"),R=e("./sequence/member/instance/unique"),L=e("./sequence/member/instance/fmap"),I=e("./sequence/member/instance/ap"),U=e("./sequence/member/instance/bind"),z=e("./sequence/member/instance/join"),A=e("./sequence/member/instance/mapM"),C=e("./sequence/member/instance/filterM"),F=e("./sequence/member/instance/map"),N=e("./sequence/member/instance/filter"),D=e("./sequence/member/instance/scanl"),$=e("./sequence/member/instance/foldr"),H=e("./sequence/member/instance/group"),W=e("./sequence/member/instance/inits"),V=e("./sequence/member/instance/tails"),G=e("./sequence/member/instance/segs"),B=e("./sequence/member/instance/subsequences"),J=e("./sequence/member/instance/permutations");e("../compose").compose(r.Sequence,s.default,i.default,o.default,c.default,u.default,a.default,l.default,d.default,h.default,f.default,p.default,m.default,v.default,b.default,y.default,w.default,q.default,S.default,g.default,_.default,x.default,E.default,T.default,j.default,O.default,M.default,P.default,k.default,R.default,L.default,I.default,U.default,z.default,A.default,C.default,F.default,N.default,D.default,$.default,H.default,W.default,V.default,G.default,B.default,J.default)},{"../compose":7,"./sequence/core":26,"./sequence/member/instance/ap":27,"./sequence/member/instance/bind":28,"./sequence/member/instance/drop":29,"./sequence/member/instance/dropUntil":30,"./sequence/member/instance/dropWhile":31,"./sequence/member/instance/extract":32,"./sequence/member/instance/filter":33,"./sequence/member/instance/filterM":34,"./sequence/member/instance/fmap":35,"./sequence/member/instance/foldr":36,"./sequence/member/instance/group":37,"./sequence/member/instance/inits":38,"./sequence/member/instance/iterate":39,"./sequence/member/instance/join":40,"./sequence/member/instance/map":41,"./sequence/member/instance/mapM":42,"./sequence/member/instance/memoize":43,"./sequence/member/instance/permutations":44,"./sequence/member/instance/reduce":45,"./sequence/member/instance/scanl":46,"./sequence/member/instance/segs":47,"./sequence/member/instance/sort":48,"./sequence/member/instance/subsequences":49,"./sequence/member/instance/tails":50,"./sequence/member/instance/take":51,"./sequence/member/instance/takeUntil":52,"./sequence/member/instance/takeWhile":53,"./sequence/member/instance/unique":54,"./sequence/member/static/concat":55,"./sequence/member/static/cycle":56,"./sequence/member/static/difference":57,"./sequence/member/static/from":58,"./sequence/member/static/intersect":59,"./sequence/member/static/mappend":60,"./sequence/member/static/mconcat":61,"./sequence/member/static/mempty":62,"./sequence/member/static/mplus":63,"./sequence/member/static/mzero":64,"./sequence/member/static/pure":65,"./sequence/member/static/random":66,"./sequence/member/static/resume":67,"./sequence/member/static/return":68,"./sequence/member/static/sequence":69,"./sequence/member/static/union":70,"./sequence/member/static/zip":71}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../monadplus");class s extends r.MonadPlus{constructor(e){super(i),this.cons=e}[Symbol.iterator](){let e=()=>this.iterate();return{next(){const t=e();return e=s.Thunk.iterator(t),{done:!s.isIterable(t),value:s.Thunk.value(t)}}}}}function i(){throw new Error("Spica: Sequence: Invalid thunk call.")}n.Sequence=s,s=n.Sequence||(n.Sequence={}),function(e){let t,n,r,s;!function(n){(t=e.Data||(e.Data={})).cons=function(t,n){switch(arguments.length){case 0:return[];case 1:return[t];case 2:return[t,n];default:throw e.Exception.invalidConsError(arguments)}}}(),function(e){e.value=function(e){return e[0]},e.iterator=function(e){return e[1]},e.index=function(e){return e[2]}}(n=e.Thunk||(e.Thunk={})),function(t){t.done=(()=>[void 0,t.done,-1]),t.when=function t(r,s,i){return e.isIterable(r)?i(r,()=>t(n.iterator(r)(),s,i)):s(r)}}(r=e.Iterator||(e.Iterator={})),e.isIterable=function(e){return n.iterator(e)!==r.done},function(e){e.invalidConsError=function(e){return console.error(e,e.length,e[0],e[1]),new TypeError("Spica: Sequence: Invalid parameters of cons.")},e.invalidDataError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid data.")},e.invalidThunkError=function(e){return console.error(e),new TypeError("Spica: Sequence: Invalid thunk.")}}(s=e.Exception||(e.Exception={}))}(s=n.Sequence||(n.Sequence={}))},{"../monadplus":24}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{ap(e){return r.Sequence.ap(this,e)}}},{"../../core":26}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{bind(e){return r.Sequence.concat(this.fmap(e))}}},{"../../core":26}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{drop(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,s)=>r.Sequence.Thunk.index(t)<e?s():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}}},{"../../core":26}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{dropUntil(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,s)=>e(r.Sequence.Thunk.value(t))?s():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}}},{"../../core":26}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{dropWhile(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,s)=>e(r.Sequence.Thunk.value(t))?s():n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}}},{"../../core":26}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),s=e("../../../../concat");n.default=class extends r.Sequence{extract(){const e=[];let t=()=>this.iterate();for(;;){const n=t();if(!r.Sequence.isIterable(n))return e;s.concat(e,[r.Sequence.Thunk.value(n)]),t=r.Sequence.Thunk.iterator(n)}}}},{"../../../../concat":8,"../../core":26}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{filter(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),(t,s)=>e(r.Sequence.Thunk.value(t),r.Sequence.Thunk.index(t))?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):s()))}}},{"../../core":26}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),s=e("../../../../concat");n.default=class extends r.Sequence{filterM(e){return r.Sequence.from([0]).bind(()=>{const t=this.extract();switch(t.length){case 0:return r.Sequence.from([[]]);default:{const n=t.shift();return e(n).bind(i=>i?0===t.length?r.Sequence.from([[n]]):r.Sequence.from(t).filterM(e).fmap(e=>s.concat([n],e)):0===t.length?r.Sequence.from([[]]):r.Sequence.from(t).filterM(e))}}})}}},{"../../../../concat":8,"../../core":26}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{fmap(e){return new r.Sequence((t=(()=>this.iterate()))=>r.Sequence.Iterator.when(t(),()=>r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(t)),r.Sequence.Thunk.iterator(t))))}}},{"../../core":26}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{foldr(e,t){return new r.Sequence((n=(()=>this.reduce().iterate()))=>r.Sequence.Iterator.when(n(),()=>r.Sequence.Data.cons(t),n=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(n),r.Sequence.resume(r.Sequence.Thunk.iterator(n)).foldr(e,t))))).bind(e=>e)}}},{"../../core":26}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),s=e("../../../../concat");n.default=class extends r.Sequence{group(e){return new r.Sequence(([t,n]=[()=>this.iterate(),[]],i)=>r.Sequence.Iterator.when(t(),()=>0===n.length?i():i(n),(t,o)=>0===n.length||e(n[0],r.Sequence.Thunk.value(t))?(s.concat(n,[r.Sequence.Thunk.value(t)]),o()):i(n,[r.Sequence.Thunk.iterator(t),s.concat([],[r.Sequence.Thunk.value(t)])])))}}},{"../../../../concat":8,"../../core":26}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{inits(){return r.Sequence.mappend(r.Sequence.from([[]]),this.scanl((e,t)=>e.concat([t]),[]).dropWhile(e=>0===e.length))}}},{"../../core":26}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{iterate(){return this.iterate_()}iterate_(e,t=0){const n=this.cons(e,r.Sequence.Data.cons);switch(n.length){case 0:return[void 0,r.Sequence.Iterator.done,-1];case 1:return[n[0],()=>r.Sequence.Iterator.done(),t];case 2:return[n[0],()=>this.iterate_(n[1],t+1),t];default:throw r.Sequence.Exception.invalidDataError(n)}}}},{"../../core":26}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{join(){return r.Sequence.concat(this)}}},{"../../core":26}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{map(e){return new r.Sequence((t=(()=>this.iterate()))=>r.Sequence.Iterator.when(t(),()=>r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(e(r.Sequence.Thunk.value(t),r.Sequence.Thunk.index(t)),r.Sequence.Thunk.iterator(t))))}}},{"../../core":26}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),s=e("../../../../concat");n.default=class extends r.Sequence{mapM(e){return r.Sequence.from([0]).bind(()=>{const t=this.extract();switch(t.length){case 0:return r.Sequence.mempty;default:{const n=t.shift();return e(n).bind(n=>0===t.length?r.Sequence.from([[n]]):r.Sequence.from(t).mapM(e).fmap(e=>s.concat([n],e)))}}})}}},{"../../../../concat":8,"../../core":26}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),s=new WeakMap;n.default=class extends r.Sequence{memoize(){return new r.Sequence(([e,t]=[0,s.get(this)||s.set(this,new Map).get(this)],n)=>r.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?r.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),()=>n(),s=>n(r.Sequence.Thunk.value(s),[e+1,t])))}}},{"../../core":26}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{permutations(){return r.Sequence.from([0]).bind(()=>{const e=this.extract();return 0===e.length?r.Sequence.mempty:r.Sequence.from([e])}).bind(e=>r.Sequence.mappend(r.Sequence.from([e]),function e(t,n){return r.Sequence.Iterator.when(t.iterate(),()=>r.Sequence.mempty,t=>new r.Sequence((o,c)=>r.Sequence.Iterator.when(t,()=>c(),t=>{const o=r.Sequence.Thunk.value(t),u=r.Sequence.resume(r.Sequence.Thunk.iterator(t)).memoize();return c(n.permutations().foldr((e,t)=>(s=r.Sequence.from(e),i=t,function e(t,n,s){return r.Sequence.Iterator.when(n.iterate(),()=>[u,s],n=>{const i=r.Sequence.Thunk.value(n),[c,u]=e(e=>t(r.Sequence.mappend(r.Sequence.from([i]),e)),r.Sequence.resume(r.Sequence.Thunk.iterator(n)),s);return[r.Sequence.mappend(r.Sequence.from([i]),c),r.Sequence.mappend(r.Sequence.from([t(r.Sequence.mappend(r.Sequence.from([o]),r.Sequence.mappend(r.Sequence.from([i]),c))).extract()]),u)]})}(e=>e,s,i)[1]),e(u,r.Sequence.mappend(r.Sequence.from([o]),n))))})).bind(e=>e));var s,i}(r.Sequence.from(e),r.Sequence.mempty)))}}},{"../../core":26}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{reduce(){return new r.Sequence(([e,t]=[0,new Map],n)=>r.Sequence.Iterator.when(t.get(e)||t.set(e,e>0&&t.has(e-1)?r.Sequence.Thunk.iterator(t.get(e-1))():this.iterate()).get(e),()=>n(),s=>n(r.Sequence.Thunk.value(s),[e+1,t])))}}},{"../../core":26}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{scanl(e,t){return new r.Sequence(([n,s,i]=[t,()=>this.iterate(),0])=>r.Sequence.Iterator.when(s(),()=>0===i?r.Sequence.Data.cons(t):r.Sequence.Data.cons(),t=>r.Sequence.Data.cons(n=e(n,r.Sequence.Thunk.value(t)),[n,r.Sequence.Thunk.iterator(t),r.Sequence.Thunk.index(t)+1])))}}},{"../../core":26}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),s=e("../../../../concat");n.default=class extends r.Sequence{segs(){return r.Sequence.mappend(this.foldr((e,t)=>t.take(1).bind(n=>r.Sequence.mappend(r.Sequence.from([r.Sequence.mappend(r.Sequence.from([[e]]),r.Sequence.from(n).map(t=>s.concat([e],t)))]),t)),r.Sequence.from([r.Sequence.from([])])).bind(e=>e),r.Sequence.from([[]]))}}},{"../../../../concat":8,"../../core":26}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{sort(e){return r.Sequence.from(this.extract().sort(e))}}},{"../../core":26}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core"),s=e("../../../../concat");n.default=class extends r.Sequence{subsequences(){return r.Sequence.mappend(r.Sequence.from([[]]),r.Sequence.from([0]).bind(()=>(function e(t){return r.Sequence.Iterator.when(t.iterate(),()=>r.Sequence.mempty,t=>r.Sequence.mappend(r.Sequence.from([[r.Sequence.Thunk.value(t)]]),new r.Sequence((n,i)=>r.Sequence.Iterator.when(t,()=>i(),t=>i(e(r.Sequence.resume(r.Sequence.Thunk.iterator(t))).foldr((e,n)=>r.Sequence.mappend(r.Sequence.mappend(r.Sequence.from([e]),r.Sequence.from([s.concat([r.Sequence.Thunk.value(t)],e)])),n),r.Sequence.mempty)))).bind(e=>e)))})(this)))}}},{"../../../../concat":8,"../../core":26}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{tails(){return r.Sequence.mappend(r.Sequence.from(this.extract().map((e,t,n)=>n.slice(t))),r.Sequence.from([[]]))}}},{"../../core":26}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{take(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(e>0?t():r.Sequence.Iterator.done(),()=>n(),t=>r.Sequence.Thunk.index(t)+1<e?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):n(r.Sequence.Thunk.value(t))))}}},{"../../core":26}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{takeUntil(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),t=>e(r.Sequence.Thunk.value(t))?n(r.Sequence.Thunk.value(t)):n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t))))}}},{"../../core":26}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{takeWhile(e){return new r.Sequence((t=(()=>this.iterate()),n)=>r.Sequence.Iterator.when(t(),()=>n(),t=>e(r.Sequence.Thunk.value(t))?n(r.Sequence.Thunk.value(t),r.Sequence.Thunk.iterator(t)):n()))}}},{"../../core":26}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{unique(){const e=new Set;return this.filter(t=>!e.has(t)&&!!e.add(t))}}},{"../../core":26}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static concat(e){return new r.Sequence(([t,n]=[()=>e.iterate(),r.Sequence.Iterator.done],s)=>r.Sequence.Iterator.when(t(),()=>s(),(e,t)=>(n=n===r.Sequence.Iterator.done?()=>r.Sequence.Thunk.value(e).iterate():n,r.Sequence.Iterator.when(n(),()=>(n=r.Sequence.Iterator.done,t()),t=>s(r.Sequence.Thunk.value(t),[()=>e,r.Sequence.Thunk.iterator(t)])))))}}},{"../../core":26}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static cycle(e){return new r.Sequence(function t([n,r]=[e[Symbol.iterator](),0],s){const i=n.next();return i.done?t([e[Symbol.iterator](),r+1],s):s(i.value,[n,r+1])}).reduce()}}},{"../../core":26}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static difference(e,t,n){return new r.Sequence(([s,i]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(s(),()=>r.Sequence.Iterator.when(i(),()=>o(),e=>o(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),(e,t)=>r.Sequence.Iterator.when(i(),()=>o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Iterator.done]),s=>{const c=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(s));return c<0?o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),()=>s]):c>0?o(r.Sequence.Thunk.value(s),[()=>e,r.Sequence.Thunk.iterator(s)]):(i=(()=>r.Sequence.Thunk.iterator(s)()),t())})))}}},{"../../core":26}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static from(e){return new r.Sequence(([t,n]=[e[Symbol.iterator](),0],r)=>{const s=t.next();return s.done?r():r(s.value,[t,n+1])}).reduce()}}},{"../../core":26}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static intersect(e,t,n){return new r.Sequence(([s,i]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(s(),()=>o(),(e,t)=>r.Sequence.Iterator.when(i(),()=>o(),(s,c)=>{const u=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(s));return u<0?(i=(()=>s),t()):u>0?c():o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(s)])})))}}},{"../../core":26}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static mappend(e,t){return r.Sequence.mconcat([e,t])}}},{"../../core":26}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static mconcat(e){return[...e].reduce((e,s)=>(t=e,n=s,new r.Sequence(([e,s]=[()=>t.iterate(),()=>n.iterate()],i)=>r.Sequence.Iterator.when(e(),()=>r.Sequence.Iterator.when(s(),()=>i(),e=>i(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),e=>i(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),s])))),r.Sequence.mempty);var t,n}}},{"../../core":26}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");class s extends r.Sequence{}s.mempty=new r.Sequence((e,t)=>t()),n.default=s},{"../../core":26}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");class s extends r.Sequence{}s.mplus=r.Sequence.mappend,n.default=s},{"../../core":26}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");class s extends r.Sequence{}s.mzero=r.Sequence.mempty,n.default=s},{"../../core":26}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static pure(e){return new r.Sequence((t,n)=>n(e))}}},{"../../core":26}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static random(e=(()=>Math.random())){return"function"==typeof e?r.Sequence.from(new r.Sequence((t,n)=>n(e(),t))):this.random().map(t=>e[t*e.length|0])}}},{"../../core":26}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static resume(e){return new r.Sequence((t=e,n)=>r.Sequence.Iterator.when(t(),()=>n(),e=>n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.iterator(e))))}}},{"../../core":26}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static Return(e){return new r.Sequence((t,n)=>n(e))}}},{"../../core":26}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static sequence(e){return e.reduce((e,t)=>e.fmap(e=>r.Sequence.mappend(e,t)),r.Sequence.Return(r.Sequence.from([])))}}},{"../../core":26}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static union(e,t,n){return new r.Sequence(([s,i]=[()=>e.iterate(),()=>t.iterate()],o)=>r.Sequence.Iterator.when(s(),()=>r.Sequence.Iterator.when(i(),()=>o(),e=>o(r.Sequence.Thunk.value(e),[r.Sequence.Iterator.done,r.Sequence.Thunk.iterator(e)])),e=>r.Sequence.Iterator.when(i(),()=>o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Iterator.done]),t=>{const s=n(r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(t));return s<0?o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),()=>t]):s>0?o(r.Sequence.Thunk.value(t),[()=>e,r.Sequence.Thunk.iterator(t)]):o(r.Sequence.Thunk.value(e),[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(t)])})))}}},{"../../core":26}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../core");n.default=class extends r.Sequence{static zip(e,t){return new r.Sequence(([n,s]=[()=>e.iterate(),()=>t.iterate()],i)=>r.Sequence.Iterator.when(n(),()=>i(),e=>r.Sequence.Iterator.when(s(),()=>i(),t=>i([r.Sequence.Thunk.value(e),r.Sequence.Thunk.value(t)],[r.Sequence.Thunk.iterator(e),r.Sequence.Thunk.iterator(t)]))))}}},{"../../core":26}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./concat"),s=e("./equal"),i=e("./exception");var o,c;(c=o=n.RegisterItemType||(n.RegisterItemType={})).monitor="monitor",c.subscriber="subscriber";function u(e,t,n,r){return e.some(({type:e,namespace:s,listener:i})=>e===t&&s.length===n.length&&s.every((e,t)=>s[t]===n[t])&&i===r)}function a(e,t){switch(typeof e){case"function":return;default:throw new TypeError(`Spica: Observation: Invalid listener.\n\t${t} ${e}`)}}n.Observation=class{constructor(){this.relaySources=new WeakSet,this.node_={parent:void 0,children:new Map,childrenNames:[],items:[]}}monitor(e,t,{once:n=!1}={}){a(t,e);const{items:r}=this.seekNode_(e);return u(r,o.monitor,e,t)?()=>void 0:(r.push({type:o.monitor,namespace:e,listener:t,options:{once:n}}),()=>this.off(e,t,o.monitor))}on(e,t,{once:n=!1}={}){a(t,e);const{items:r}=this.seekNode_(e);return u(r,o.subscriber,e,t)?()=>void 0:(r.push({type:o.subscriber,namespace:e,listener:t,options:{once:n}}),()=>this.off(e,t))}once(e,t){return a(t,e),this.on(e,t,{once:!0})}off(e,t,n=o.subscriber){switch(typeof t){case"function":return void this.seekNode_(e).items.some(({type:e,listener:r},s,i)=>{if(r!==t)return!1;if(e!==n)return!1;switch(s){case 0:return!void i.shift();case i.length-1:return!void i.pop();default:return!void i.splice(s,1)}});case"undefined":{const t=this.seekNode_(e);return t.childrenNames.slice().forEach(n=>{this.off(e.concat([n]));const r=t.children.get(n);r&&(r.items.length+r.childrenNames.length>0||(t.children.delete(n),t.childrenNames.splice(s.findIndex(n,t.childrenNames),1)))}),void(t.items=t.items.filter(({type:e})=>e===o.monitor))}default:throw a(t,e)}}emit(e,t,n){this.drain_(e,t,n)}reflect(e,t){let n=[];return this.emit(e,t,(e,t)=>n=t),n}relay(e){if(this.relaySources.has(e))return()=>void 0;this.relaySources.add(e);const t=e.monitor([],(e,t)=>void this.emit(t,e));return()=>(this.relaySources.delete(e),t())}drain_(e,t,n){const r=[];if(this.refsBelow_(this.seekNode_(e)).reduce((s,{type:c,listener:u,options:{once:a}})=>{if(c===o.subscriber){a&&this.off(e,u);try{const s=u(t,e);n&&(r[r.length]=s)}catch(e){i.causeAsyncException(e)}}},void 0),this.refsAbove_(this.seekNode_(e)).reduce((n,{type:r,listener:s,options:{once:c}})=>{if(r===o.monitor){c&&this.off(e,s,o.monitor);try{s(t,e)}catch(e){i.causeAsyncException(e)}}},void 0),n)try{n(t,r)}catch(e){i.causeAsyncException(e)}}refs(e){return this.refsBelow_(this.seekNode_(e))}refsAbove_({parent:e,items:t}){for(t=r.concat([],t);e;)t=r.concat(t,e.items),e=e.parent;return t}refsBelow_({childrenNames:e,children:t,items:n}){n=r.concat([],n);for(let i=0;i<e.length;++i){const o=e[i],c=this.refsBelow_(t.get(o));n=r.concat(n,c),0===c.length&&(t.delete(o),e.splice(s.findIndex(o,e),1),--i)}return n}seekNode_(e){let t=this.node_;for(const n of e){const{children:e}=t;e.has(n)||(t.childrenNames.push(n),e.set(n,{parent:t,children:new Map,childrenNames:[],items:[]})),t=e.get(n)}return t}}},{"./concat":8,"./equal":11,"./exception":12}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./monad/sequence"))},{"./monad/sequence":25}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r="0".repeat(15);let s=0;n.sqid=function(e){if(arguments.length>0){if("number"!=typeof e)throw new TypeError(`Spica: sqid: A parameter value must be a number: ${e}`);if(e>=0==0)throw new TypeError(`Spica: sqid: A parameter value must be a positive number: ${e}`);if(e%1!=0)throw new TypeError(`Spica: sqid: A parameter value must be an integer: ${e}`)}return void 0===e?(r+ ++s).slice(-15):(r+e).slice(-15)}},{}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./observation"),s=e("./assign"),i=e("./tick"),o=e("./sqid"),c=e("./exception");class u{constructor(e={}){if(this.id=o.sqid(),this.settings={name:"",size:1/0,timeout:1/0,destructor:e=>void 0,scheduler:i.tick,resource:10},this.events_={init:new r.Observation,loss:new r.Observation,exit:new r.Observation},this.events=this.events_,this.workers=new Map,this.alive=!0,this.available_=!0,this.scheduler=(()=>void(0,this.settings.scheduler)(this.deliver)),this.messages=[],this.deliver=(()=>{const e=Date.now();for(let t=0,n=this.messages.length;this.available&&t<n;++t){if(this.settings.resource-(Date.now()-e)<=0)return void this.schedule();const[r,s,i,o]=this.messages[t],u=this.workers.has(r)?this.workers.get(r).call([s,o]):void 0;if(!(void 0===u&&Date.now()<o))if(0===t?this.messages.shift():this.messages.splice(t,1),--t,--n,void 0===u){this.events_.loss.emit([r],[r,s]);try{i(void 0,new Error("Spica: Supervisor: A processing has failed."))}catch(e){c.causeAsyncException(e)}}else u.then(e=>void i(e),()=>void i(void 0,new Error("Spica: Supervisor: A processing has failed.")))}}),Object.freeze(s.extend(this.settings,e)),this.name=this.settings.name,this.constructor===u)throw new Error(`Spica: Supervisor: <${this.id}/${this.name}>: Cannot instantiate abstract classes.`);this.constructor.instances.add(this)}static get instances(){return this.hasOwnProperty("instances_")?this.instances_:this.instances_=new Set}static get count(){return this.instances.size}static get procs(){return[...this.instances].reduce((e,t)=>e+t.workers.size,0)}destructor(e){for(this.available_=!1,this.workers.forEach(t=>void t.terminate(e)),Object.freeze(this.workers);this.messages.length>0;){const[e,t]=this.messages.shift();this.events_.loss.emit([e],[e,t])}Object.freeze(this.messages),this.alive=!1,this.constructor.instances.delete(this),Object.freeze(this),this.settings.destructor(e)}get available(){return this.available_}throwErrorIfNotAvailable(){if(!this.available)throw new Error(`Spica: Supervisor: <${this.id}/${this.name}>: A supervisor is already terminated.`)}register(e,t,n,r){if(this.throwErrorIfNotAvailable(),arguments.length>3)return this.kill(e,r),this.register(e,t,n);if(this.workers.has(e))throw new Error(`Spica: Supervisor: <${this.id}/${this.name}/${e}>: Cannot register a process multiply with the same name.`);return this.schedule(),t="function"==typeof t?{init:e=>e,main:t,exit:e=>void 0}:t,this.workers.set(e,new a(this,e,t,n,this.events_,()=>void this.workers.delete(e))).get(e).terminate}call(e,t,n=this.settings.timeout,r=this.settings.timeout){if("number"==typeof n)return new Promise((n,s)=>void this.call(e,t,(e,t)=>t?s(t):n(e),r));for(this.throwErrorIfNotAvailable(),this.messages.push([e,t,n,Date.now()+r]);this.messages.length>this.settings.size;){const[e,t,n]=this.messages.shift();this.events_.loss.emit([e],[e,t]);try{n(void 0,new Error("Spica: Supervisor: A message overflowed."))}catch(e){c.causeAsyncException(e)}}this.schedule(),r<=0||r!==1/0&&setTimeout(()=>void this.schedule(),r+3)}cast(e,t,n=this.settings.timeout){this.throwErrorIfNotAvailable();const r=this.workers.has(e)?this.workers.get(e).call([t,n]):void 0;return void 0===r&&this.events_.loss.emit([e],[e,t]),void 0!==r&&(r.catch(()=>void 0),!0)}refs(e){return this.throwErrorIfNotAvailable(),void 0===e?[...this.workers.values()].map(t):this.workers.has(e)?[t(this.workers.get(e))]:[];function t(e){return[e.name,e.process,e.state,e.terminate]}}kill(e,t){return!!this.available&&(!!this.workers.has(e)&&this.workers.get(e).terminate(t))}terminate(e){return!!this.available&&(this.destructor(e),!0)}schedule(){0!==this.messages.length&&i.tick(this.scheduler,!0)}}n.Supervisor=u;class a{constructor(e,t,n,r,s,i){this.sv=e,this.name=t,this.process=n,this.state=r,this.events=s,this.destructor_=i,this.alive=!0,this.available=!0,this.initiated=!1,this.terminate=(e=>!!this.alive&&(this.destructor(e),!0))}destructor(e){if(this.alive=!1,this.available=!1,Object.freeze(this),this.destructor_(),this.initiated)try{this.process.exit(e,this.state),this.events.exit.emit([this.name],[this.name,this.process,this.state,e])}catch(t){this.events.exit.emit([this.name],[this.name,this.process,this.state,e]),this.sv.terminate(t)}}call([e,t]){const n=Date.now();if(this.available&&!(n>t))return new Promise((r,s)=>{isFinite(t)&&setTimeout(()=>void s(new Error),t-n),this.available=!1,this.initiated||(this.initiated=!0,this.events.init.emit([this.name],[this.name,this.process,this.state]),this.state=this.process.init(this.state)),Promise.resolve(this.process.main(e,this.state)).then(r,s)}).then(e=>{const[t,n]=Array.isArray(e)?e:[e.reply,e.state];return this.alive?(this.sv.schedule(),this.state=n,this.available=!0,t):t}).catch(e=>{throw this.sv.schedule(),this.terminate(e),e})}}},{"./assign":4,"./exception":12,"./observation":72,"./sqid":74,"./tick":77}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.throttle=function(e,t){let n=0,r=[];return s=>{r.push(s),n>0||(n=setTimeout(()=>{n=0,t(r[r.length-1],function(){const e=r;return r=[],e}())},e))}},n.debounce=function(e,t){let n=0,r=[];return s=>{r.push(s),n>0||(n=setTimeout(()=>{n=0,setTimeout(()=>{n>0||t(r[r.length-1],function(){const e=r;return r=[],e}())},e)},e))}}},{}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./exception");let s=[],i=new WeakSet;n.tick=function(e,t=!1){if(t){if(i.has(e))return;i.add(e)}s.push(e),1===s.length&&o.then(c)};const o=Promise.resolve();function c(){const e=function(){const e=s;return s=[],i=new WeakSet,e}();for(;;){try{for(;e.length>0;)e.shift()()}catch(e){r.causeAsyncException(e);continue}return}}},{"./exception":12}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tuple=function(e){return e}},{}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.type=function(e){const t=Object.prototype.toString.call(e).split(" ").pop().slice(0,-1);return"object"!=typeof e&&e instanceof Object==0||null===e?t.toLowerCase():t}},{}],80:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uncurry=(e=>t=>e(...t.slice(0,e.length)))},{}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./src/export"));var r=e("./src/export");n.default=r.default},{"./src/export":84}],82:[function(e,t,n){"use strict";var r,s;Object.defineProperty(n,"__esModule",{value:!0}),(s=r||(r={})).Void="void",s.Text="text",s.Collection="collection",s.Record="record";const i=new WeakSet;function o({element:e}){if(null!==e.parentElement&&i.has(e.parentElement))throw new Error("TypedDOM: Cannot add an element used in another typed dom.")}n.El=class{constructor(e,t){switch(this.element_=e,this.children_=t,this.type=void 0===this.children_?r.Void:"string"==typeof this.children_?r.Text:Array.isArray(this.children_)?r.Collection:r.Record,this.tag,o(this),i.add(e),this.type){case r.Void:return;case r.Text:return c(),this.children_=e.appendChild(document.createTextNode("")),void(this.children=t);case r.Collection:return c(),this.children_=[],this.children=t,void u(e.id,this.children_);case r.Record:return c(),this.children_=(n=e,s=Object.assign({},t),Object.defineProperties(s,Object.entries(s).reduce((e,[t,r])=>(o(r),n.appendChild(r.element),e[t]={configurable:!0,enumerable:!0,get:()=>r,set:e=>{const t=r;e!==t&&(e.element_.parentElement===n||o(e),r=e,n.replaceChild(e.element,t.element))}},e),{}))),void u(e.id,this.children_)}var n,s;function c(){for(;e.childNodes.length>0;)e.removeChild(e.firstChild)}function u(e,t){var n,r;e.match(/^[\w\-]+$/)&&Object.values(t).map(({element:e})=>e).forEach(t=>t instanceof HTMLStyleElement&&(n=t,r=e,n.innerHTML=n.innerHTML.replace(/^\s*\$scope(?!\w)/gm,`#${r}`),void[...n.querySelectorAll("*")].forEach(e=>void e.remove())))}}get element(){return this.element_}get children(){switch(this.type){case r.Text:return this.children_.data;default:return this.children_}}set children(e){switch(this.type){case r.Void:return;case r.Text:return void(this.children_.data=e);case r.Collection:return this.children_.reduce((e,t)=>{const n=e.indexOf(t);return n>-1?e:(e.splice(n,1),t.element.remove(),e)},[...e]),this.children_=[],e.forEach((e,t)=>{e.element_.parentElement===this.element_||o(e),this.children_[t]=e,this.element_.appendChild(e.element)}),void Object.freeze(this.children_);case r.Record:return void Object.keys(this.children_).forEach(t=>this.children_[t]=e[t])}}}},{}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./builder");var s,i;function o(e){return{get:(i,o)=>i[o]||"string"!=typeof o?i[o]:i[o]=(t=e,n=o,function e(i,o,c){return"function"==typeof i?e(void 0,void 0,i):"function"==typeof o?e(i,void 0,o):void 0===i||"object"==typeof(u=i)&&!Object.values(u).slice(-1).every(e=>"object"==typeof e)?new r.El(function(e,n,r){const i=(n=n||function(){switch(t){case s.HTML:return document.createElement(e);case s.SVG:return document.createElementNS("http://www.w3.org/2000/svg",e);default:throw new Error(`TypedDOM: Namespace must be "${s.HTML}" or "${s.SVG}", but got "${t}".`)}})();if(e!==i.tagName.toLowerCase())throw new Error(`TypedDOM: Tag name must be "${e}", but got "${i.tagName.toLowerCase()}".`);return r?(Object.entries(r).forEach(([e,t])=>"string"==typeof t?void i.setAttribute(e,t):void i.addEventListener(e.slice(2),t,{passive:["wheel","mousewheel","touchstart","touchmove"].includes(e.slice(2))})),i):i}(n,c,i),o):e(void 0,i,c);var u})};var t,n}(i=s||(s={})).HTML="html",i.SVG="svg",n.TypedHTML=new Proxy({},o(s.HTML)),n.TypedSVG=new Proxy({},o(s.SVG))},{"./builder":82}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./dom/html");n.default=r.TypedHTML,n.TypedHTML=r.TypedHTML,n.TypedSVG=r.TypedSVG,function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("./util/dom"))},{"./dom/html":83,"./util/dom":85}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./noop");function s(e,t,n,r=!1,s={}){return"string"==typeof n?o(e,t,n,r,Object.assign({},"boolean"==typeof s?{capture:s}:s,{once:!0})):i(e,t,n,Object.assign({},"boolean"==typeof r?{capture:r}:r,{once:!0}))}function i(e,t,s,i=!1){e.addEventListener(t,u,a(i));let o=()=>(o=r.noop,void e.removeEventListener(t,u,a(i)));return()=>void o();function u(e){"object"==typeof i&&(i.passive&&(e.preventDefault=r.noop),i.once&&o()),n.currentTargets.set(e,e.currentTarget),s(e)}function a(e){return c?e:"boolean"==typeof e?e:!!e.capture}}function o(e,t,n,r,o={}){return i(e instanceof Document?e.documentElement:e,n,i=>{const c=i.target.closest(t);c&&[...e.querySelectorAll(t)].filter(e=>e===c).forEach(e=>void s(e,n,e=>{r(e)},o))},Object.assign({},o,{capture:!0}))}n.currentTargets=new WeakMap,n.listen=function(e,t,n,r=!1,s={}){return"string"==typeof n?o(e,t,n,r,s):i(e,t,n,r)},n.once=s,n.bind=i,n.delegate=o;let c=!1;try{document.createElement("div").addEventListener("test",function(){},{get capture(){return c=!0}})}catch(e){}},{"./noop":86}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.noop=function(){}},{}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./layer/interface/service/gui");n.default=r.GUI;var s=e("./layer/interface/service/gui");n.Pjax=s.GUI;var i=e("./lib/router");n.router=i.router},{"./layer/interface/service/gui":119,"./lib/router":130}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../domain/router/api");var s=e("../domain/event/router");n.RouterEvent=s.RouterEvent,n.RouterEventType=s.RouterEventType,n.RouterEventSource=s.RouterEventSource;var i=e("../domain/data/config");n.Config=i.Config,n.scope=i.scope,n.route=function(e,t,n,s){return r.route(new r.RouterEntity(e,t,new r.RouterEntityState(n.process,n.scripts)),s)}},{"../domain/data/config":92,"../domain/event/router":95,"../domain/router/api":96}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../domain/store/path");n.loadTitle=r.loadTitle,n.savePosition=r.savePosition},{"../domain/store/path":112}],90:[function(e,t,n){"use strict";var r;function s(e){return e.trim().replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,e=>2===e.length?e:"").replace(/%(?![0-9A-F]{2})|[^%\[\]]+/gi,encodeURI).replace(/\?[^#]+/,e=>"?"+e.slice(1).replace(/%[0-9A-F]{2}|[^=&]/gi,e=>e.length<3?encodeURIComponent(e):e)).replace(/%[0-9A-F]{2}/gi,e=>e.toUpperCase()).replace(/#.+/,e.slice(e.indexOf("#")))}Object.defineProperty(n,"__esModule",{value:!0}),r||(r={}),n.standardizeUrl=function(e){return s((t=e,i.href=t||location.href,i.href.replace(/^([^:/?#]+:\/\/[^/?#]*?):(?:80)?(?=$|[/?#])/,"$1").replace(/^([^:/?#]+:\/\/[^/?#]*)\/?/,"$1/").replace(/%[0-9A-F]{2}/gi,e=>e.toUpperCase()).replace(/#.+/,t.slice(t.indexOf("#")))));var t},n._encode=s;const i=document.createElement("a")},{}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/assign");function s(){window.history.replaceState(r.extend(window.history.state||{},{title:document.title}),document.title)}function i(){window.history.replaceState(r.extend(window.history.state||{},{position:{top:window.pageYOffset,left:window.pageXOffset}}),document.title)}s(),i(),n.loadTitle=function(){return window.history.state.title||document.title},n.saveTitle=s,n.loadPosition=function(){return window.history.state.position||{top:window.pageYOffset,left:window.pageXOffset}},n.savePosition=i},{"spica/assign":4}],92:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("spica/assign");var i=e("./config/scope");n.scope=i.scope;n.Config=class{constructor(e){this.areas=["body"],this.link="a",this.form="form:not([method])",this.replace="",this.fetch={timeout:3e3,wait:0},this.update={head:"base, meta, link",css:!0,script:!0,ignore:"",ignores:{extension:'[href^="chrome-extension://"]',security:'[src*=".scr.kaspersky-labs.com/"]'},reload:"",logger:""},this.sequence=new o,this.progressbar="display:none;position:absolute;bottom:0;left:0;width:0;height:2px;background:rgb(40, 105, 255);",this.scope={},Object.defineProperties(this.update,{ignore:{enumerable:!1,set(e){this.ignores._=e},get(){return Object.keys(this.ignores).map(e=>this.ignores[e]).filter(e=>e.trim().length>0).join(",")}}}),s.extend(this,e),Object.freeze(this)}filter(e){return e.matches(":not([target])")}redirect(e){return e}rewrite(e,t){}fallback(e,t){if(e instanceof HTMLAnchorElement)window.location.assign(e.href);else if(e instanceof HTMLFormElement)window.location.assign(e.action);else{if(!(e instanceof Window))throw t;window.location.reload(!0)}}};class o{fetch(){return r(this,void 0,void 0,function*(){return"fetch"})}unload(){return r(this,void 0,void 0,function*(){return"unload"})}content(){return r(this,void 0,void 0,function*(){return"content"})}ready(){return r(this,void 0,void 0,function*(){return"ready"})}load(){return r(this,void 0,void 0,function*(){})}}},{"./config/scope":93,"spica/assign":4}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../../lib/router"),s=e("../../../domain/data/config"),i=e("spica/sequence"),o=e("spica/maybe"),c=e("spica/assign");n.scope=function(e,t){const n=Object.assign({"/":{}},e.scope);return i.Sequence.from(Object.keys(n).sort().reverse()).dropWhile(e=>!r.compare(e,t.orig)&&!r.compare(e,t.dest)).take(1).filter(e=>!!r.compare(e,t.orig)&&r.compare(e,t.dest)).map(e=>n[e]).map(t=>t?o.Just(new s.Config(c.extend({},e,t))):o.Nothing).extract().reduce((e,t)=>t,o.Nothing)}},{"../../../../lib/router":130,"../../../domain/data/config":92,"spica/assign":4,"spica/maybe":15,"spica/sequence":73}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../lib/error");n.DomainError=class extends r.PjaxError{constructor(e){super(`Domain: ${e}`)}}},{"../../../lib/error":128}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../lib/url"),s=e("../../data/model/domain/url"),i=e("../../../lib/dom"),o=e("typed-dom");var c,u,a,l,d;n.RouterEvent=class{constructor(e){this.original=e,this.type=this.original.type.toLowerCase(),this.source=o.currentTargets.get(this.original),this.request=new h(this.source),this.location=new f(this.request.url),Object.freeze(this)}},(u=c=n.RouterEventSource||(n.RouterEventSource={})).Anchor=HTMLAnchorElement,u.Form=HTMLFormElement,u.Window=window.Window,(a=n.RouterEventType||(n.RouterEventType={})).click="click",a.submit="submit",a.popstate="popstate",(d=l=n.RouterEventMethod||(n.RouterEventMethod={})).GET="GET",d.POST="POST";class h{constructor(e){this.source=e,this.method=(()=>{if(this.source instanceof c.Anchor)return l.GET;if(this.source instanceof c.Form)return this.source.method.toUpperCase()===l.POST?l.POST:l.GET;if(this.source instanceof c.Window)return l.GET;throw new TypeError})(),this.url=(()=>{if(this.source instanceof c.Anchor)return s.standardizeUrl(this.source.href);if(this.source instanceof c.Form)return this.source.method.toUpperCase()===l.GET?s.standardizeUrl(this.source.action.split(/[?#]/)[0]+`?${i.serialize(this.source)}`):s.standardizeUrl(this.source.action.split(/[?#]/)[0]);if(this.source instanceof c.Window)return s.standardizeUrl(window.location.href);throw new TypeError})(),this.data=(()=>this.source instanceof c.Form&&this.method===l.POST?new FormData(this.source):null)(),Object.freeze(this)}}n.RouterEventRequest=h;class f{constructor(e){this.target=e,this.orig=new r.URL(s.standardizeUrl(window.location.href)),this.dest=new r.URL(this.target),Object.freeze(this)}}n.RouterEventLocation=f},{"../../../lib/dom":127,"../../../lib/url":131,"../../data/model/domain/url":90,"typed-dom":81}],96:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("spica/either"),i=e("./module/fetch"),o=e("./module/update"),c=e("./module/update/content"),u=e("../store/path"),a=e("../data/error");var l=e("./model/eav/entity");n.RouterEntity=l.RouterEntity,n.RouterEntityState=l.RouterEntityState,n.route=function(e,t){return r(this,void 0,void 0,function*(){return s.Right(void 0).bind(e.state.process.either).bind(()=>(n=t.document,l=e.config.areas,c.separate({src:n,dst:n},l).extract(()=>!1,()=>!0)?s.Right(void 0):s.Left(new a.DomainError("Failed to match areas.")))).fmap(()=>i.fetch(e.event.request,e.config,e.state.process)).fmap(n=>r(this,void 0,void 0,function*(){return(yield n).fmap(([n,r])=>o.update(e,n,r,{document:t.document,position:u.loadPosition})).extract(s.Left)})).extract(s.Left);var n,l})}},{"../data/error":94,"../store/path":112,"./model/eav/entity":97,"./module/fetch":99,"./module/update":101,"./module/update/content":103,"spica/either":10}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.RouterEntity=class{constructor(e,t,n){this.config=e,this.event=t,this.state=n,Object.freeze(this)}};n.RouterEntityState=class{constructor(e,t){this.process=e,this.scripts=t,Object.freeze(this)}}},{}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.FetchResponse=class{constructor(e,t){this.url=e,this.xhr=t,this.header=(e=>this.xhr.getResponseHeader(e)),this.document=this.xhr.responseXML,Object.freeze(this)}}},{}],99:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("spica/either"),i=e("spica/tuple"),o=e("../module/fetch/xhr"),c=e("../../data/error"),u=e("../../../../lib/url");n.fetch=function({method:e,url:t,data:n},{redirect:a,fetch:{timeout:l,wait:d},sequence:h},f){return r(this,void 0,void 0,function*(){const r=o.xhr(e,t,n,l,a,f);window.dispatchEvent(new Event("pjax:fetch"));const[p,m]=yield Promise.all([r,h.fetch(void 0,{path:new u.URL(t).path,method:e,data:n}),new Promise(e=>void setTimeout(e,d))]);return p.bind(f.either).bind(e=>new u.URL(e.url).origin===new u.URL(t).origin?s.Right(i.tuple([e,m])):s.Left(new c.DomainError(`Request is redirected to the different domain url ${new u.URL(e.url).href}`)))})}},{"../../../../lib/url":131,"../../data/error":94,"../module/fetch/xhr":100,"spica/either":10,"spica/tuple":78}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/sequence"),s=e("spica/either"),i=e("../../model/eav/value/fetch"),o=e("../../../../data/model/domain/url"),c=e("../../../data/error"),u=e("../../../../../lib/url");function a(e,t){return r.Sequence.intersect(r.Sequence.from(n(e||"").sort()),r.Sequence.from(n(t).sort()),(e,t)=>e.localeCompare(t)).take(1).extract().length>0;function n(e){return e.split(";").map(e=>e.trim()).filter(e=>e.length>0)}}n.xhr=function(e,t,n,r,l,d){const h=o.standardizeUrl(l(new u.URL(t).path)),f=new XMLHttpRequest;return new Promise(l=>(f.open(e,new u.URL(h).path,!0),f.responseType="document",f.timeout=r,f.setRequestHeader("X-Pjax","1"),f.send(n),f.addEventListener("abort",()=>void l(s.Left(new c.DomainError("Failed to request a page by abort.")))),f.addEventListener("error",()=>void l(s.Left(new c.DomainError("Failed to request a page by error.")))),f.addEventListener("timeout",()=>void l(s.Left(new c.DomainError("Failed to request a page by timeout.")))),f.addEventListener("load",()=>void(p=f,s.Right(p).bind(e=>/2..|304/.test(`${e.status}`)?s.Right(e):s.Left(new c.DomainError("Faild to validate the status of response."))).bind(e=>a(e.getResponseHeader("Content-Type"),"text/html")?s.Right(e):s.Left(new c.DomainError("Faild to validate the content type of response.")))).fmap(e=>new i.FetchResponse(e.responseURL&&t===h?o.standardizeUrl(e.responseURL):t,e)).extract(e=>void l(s.Left(e)),e=>void l(s.Right(e)))),void d.register(()=>void f.abort())));var p},n.match_=a},{"../../../../../lib/url":131,"../../../../data/model/domain/url":90,"../../../data/error":94,"../../model/eav/value/fetch":98,"spica/either":10,"spica/sequence":73}],101:[function(e,t,n){(function(t){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("spica/either"),i=e("spica/hlist"),o=e("spica/tuple"),c=e("../../event/router"),u=e("../module/update/blur"),a=e("../module/update/url"),l=e("../module/update/title"),d=e("../module/update/head"),h=e("../module/update/content"),f=e("../module/update/css"),p=e("../module/update/script"),m=e("../module/update/focus"),v=e("../module/update/scroll"),b=e("../../store/path"),y=e("../../data/error");n.update=function({event:e,config:t,state:n},w,q,S){return r(this,void 0,void 0,function*(){const{process:g}=n,_={src:w.document,dst:S.document};return(new i.HNil).push(g.either(q)).modify(e=>e.bind(()=>h.separate(_,t.areas).extract(()=>s.Left(new y.DomainError("Failed to separate the areas.")),()=>e)).fmap(e=>r(this,void 0,void 0,function*(){return window.dispatchEvent(new Event("pjax:unload")),g.either(yield t.sequence.unload(e,w))})).fmap(e=>r(this,void 0,void 0,function*(){return(yield e).bind(e=>h.separate(_,t.areas).fmap(([t])=>[e,t]).extract(()=>s.Left(new y.DomainError("Failed to separate the areas.")),g.either))})).fmap(e=>r(this,void 0,void 0,function*(){return(yield e).bind(([e,n])=>(t.rewrite(_.src,n),h.separate(_,t.areas).fmap(([,t])=>[e,t]).extract(()=>s.Left(new y.DomainError("Failed to separate the areas.")),g.either)))}))).modify(y=>y.fmap(y=>r(this,void 0,void 0,function*(){return(yield y).bind(g.either).fmap(([y,q])=>(new i.HNil).extend(()=>r(this,void 0,void 0,function*(){return u.blur(_.dst),a.url(new c.RouterEventLocation(w.url),_.src.title,e.type,e.source,t.replace),l.title(_),b.saveTitle(),d.head({src:_.src.head,dst:_.dst.head},t.update.head,t.update.ignore),g.either(h.content(_,q)).fmap(([e,t])=>[e,Promise.all(t)])})).extend(c=>r(this,void 0,void 0,function*(){return(yield c).fmap(([s])=>Promise.all((new i.HNil).extend(()=>r(this,void 0,void 0,function*(){return t.update.css&&f.css({src:_.src.head,dst:_.dst.head},t.update.ignore),t.update.css&&f.css({src:_.src.body,dst:_.dst.body},t.update.ignore),t.update.script?yield p.script(_,n.scripts,t.update,Math.max(10*t.fetch.timeout,1e4),g):yield g.either(o.tuple([[],Promise.resolve([])]))})).extend(()=>r(this,void 0,void 0,function*(){S.document.dispatchEvent(new Event("pjax:content"));const n=yield t.sequence.content(y,s);return m.focus(e.type,_.dst),v.scroll(e.type,_.dst,{hash:e.location.dest.fragment,position:S.position}),b.savePosition(),S.document.dispatchEvent(new Event("pjax:ready")),yield t.sequence.ready(n)})).reverse().tuple())).fmap(e=>e.then(([e,t])=>e.fmap(e=>[e,t]))).extract(e=>r(this,void 0,void 0,function*(){return s.Left(e)}))})).reverse().tuple())}))).modify(e=>e.fmap(e=>r(this,void 0,void 0,function*(){return(yield e).bind(g.either).fmap(([e,n])=>r(this,void 0,void 0,function*(){return g.either(yield Promise.all([e,n])).bind(([e,n])=>e.bind(([,e])=>n.fmap(([[,n],r])=>void Promise.all([e,n]).then(g.either).then(e=>e.fmap(([e])=>(window.dispatchEvent(new Event("pjax:load")),void t.sequence.load(r,e))).extract(()=>void 0))))).extract(()=>void 0),n})).fmap(e=>r(this,void 0,void 0,function*(){return(yield e).fmap(([e])=>e)})).extract(s.Left)}))).head.extract(s.Left)})}}).call(this,e("_process"))},{"../../data/error":94,"../../event/router":95,"../../store/path":112,"../module/update/blur":102,"../module/update/content":103,"../module/update/css":104,"../module/update/focus":105,"../module/update/head":106,"../module/update/script":107,"../module/update/scroll":108,"../module/update/title":110,"../module/update/url":111,_process:3,"spica/either":10,"spica/hlist":14,"spica/tuple":78}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.blur=function(e){e===window.document&&e.activeElement!==e.body&&(e.activeElement.blur(),e.body.focus())}},{}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/maybe"),s=e("spica/concat"),i=e("spica/tuple"),o=e("typed-dom"),c=e("../../../../../lib/dom"),u=e("./script");function a(e){return(e.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[]).map(e=>e.trim())}function l(e){return Promise.race([new Promise(t=>void o.once(e,"load",t)),new Promise(t=>void o.once(e,"abort",t)),new Promise(t=>void o.once(e,"error",t))])}n.content=function(e,t,n={replace:(e,t)=>void t.parentNode.replaceChild(e,t)}){return[t.map(e=>e.dst).reduce(s.concat,[]),t.map(function(t){return t.src.map((n,r)=>({src:e.dst.importNode(t.src[r].cloneNode(!0),!0),dst:t.dst[r]})).map(e=>(!function(e){const t=c.find(e.src,"script").map(u.escape).reduce((e,t)=>()=>(e(),void t()),()=>void 0);n.replace(e.src,e.dst),t()}(e),c.find(e.src,"img, iframe, frame").map(l))).reduce(s.concat,[])}).reduce(s.concat,[])]},n.separate=function(e,t){return t.reduce((t,d)=>r.Maybe.mplus(t,(n=e,o=d,a(o).map(e=>({src:c.find(n.src,e),dst:c.find(n.dst,e)})).reduce((e,t)=>e.bind(e=>(u=t,r.Just(u).guard((l=u).src.length>0&&l.src.length===l.dst.length)).fmap(t=>s.concat(e,[t]))),r.Just([]))).fmap(e=>i.tuple([d,e]))),r.Nothing);var n,o,u,l},n._split=a,n._wait=l},{"../../../../../lib/dom":127,"./script":107,"spica/concat":8,"spica/maybe":15,"spica/tuple":78,"typed-dom":81}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../../../lib/dom"),s=e("./sync");function i(e,t){switch(e.tagName.toLowerCase()){case"link":return e.href===t.href;case"style":return e.innerHTML.trim()===t.innerHTML.trim();default:return!1}}n.css=function(e,t){const n='link[rel~="stylesheet"], style';s.sync(s.pair(r.find(e.src,n).filter(e=>!e.matches(t.trim()||"_")),r.find(e.dst,n).filter(e=>!e.matches(t.trim()||"_")),i),e.dst)}},{"../../../../../lib/dom":127,"./sync":109}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../event/router"),s=e("../../../../../lib/dom");n.focus=function(e,t){switch(e){case r.RouterEventType.click:case r.RouterEventType.submit:return void s.find(t,"[autofocus]").slice(-1).filter(e=>e.closest("html")===window.document.documentElement&&e!==t.activeElement).forEach(e=>void e.focus());case r.RouterEventType.popstate:return;default:throw new TypeError(e)}}},{"../../../../../lib/dom":127,"../../../event/router":95}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./sync"),s=e("../../../../../lib/dom");function i(e,t){return e.outerHTML===t.outerHTML}n.head=function(e,t,n){n+=t.indexOf("link")>-1?', link[rel~="stylesheet"]':"",r.sync(r.pair(s.find(e.src,t).filter(e=>!e.matches(n.trim()||"_")),s.find(e.dst,t).filter(e=>!e.matches(n.trim()||"_")),i),e.dst)}},{"../../../../../lib/dom":127,"./sync":109}],107:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("spica/either"),i=e("spica/tuple"),o=e("../../../../../lib/dom"),c=e("../../../../../lib/error"),u=e("../../../../../lib/url"),a=e("../../../../data/model/domain/url");function l(e,t){return r(this,void 0,void 0,function*(){if(e.hasAttribute("src")){if("module"===e.type.toLowerCase())return s.Right([e,""]);const n=new XMLHttpRequest;return n.open("GET",e.src,!0),n.timeout=t,n.send(),new Promise(t=>["load","abort","error","timeout"].forEach(r=>{switch(r){case"load":return void n.addEventListener(r,()=>void t(s.Right([e,n.response])));default:return void n.addEventListener(r,()=>void t(s.Left(new Error(`${e.src}: ${n.statusText}`))))}}))}return s.Right([e,e.text])})}function d(t,n,r,i,o,l){const d=!!(t=t.ownerDocument===document?t:document.importNode(t.cloneNode(!0),!0)).parentElement&&t.parentElement.matches(r.trim()||"_"),f=document.querySelector(d?t.parentElement.id?`#${t.parentElement.id}`:t.parentElement.tagName:"_")||document.body,p=h(t);f.appendChild(t),p(),!d&&t.remove();const m=new u.URL(a.standardizeUrl(window.location.href));return"module"===t.type.toLowerCase()?s.Right(o.then(()=>Promise.resolve().then(()=>e(t.src))).then(()=>(t.dispatchEvent(new Event("load")),s.Right(t)),e=>(t.dispatchEvent(new Event("error")),s.Left(new c.FatalError(e instanceof Error?e.message:e+""))))):t.hasAttribute("defer")?s.Right(o.then(v)):t.hasAttribute("async")?s.Right(Promise.resolve().then(v)):s.Left(v());function v(){if(l.canceled)return l.either(t);try{if(new u.URL(a.standardizeUrl(window.location.href)).path!==m.path)throw new c.FatalError("Expired.");if(i.has(new u.URL(a.standardizeUrl(window.location.href)).href))throw new c.FatalError("Expired.");return(0,eval)(n),t.hasAttribute("src")&&t.dispatchEvent(new Event("load")),s.Right(t)}catch(e){return t.hasAttribute("src")&&t.dispatchEvent(new Event("error")),s.Left(new c.FatalError(e instanceof Error?e.message:e+""))}}}function h(e){const t=e.hasAttribute("src")?e.getAttribute("src"):null,n=e.text;return e.removeAttribute("src"),e.text="",()=>(e.text=" ",e.text=n,"string"==typeof t?void e.setAttribute("src",t):void 0)}n.script=function(e,t,n,c,h,f={fetch:l,evaluate:d}){return r(this,void 0,void 0,function*(){const r=o.find(e.src,"script").filter(e=>!e.type||/(?:application|text)\/(?:java|ecma)script|module/i.test(e.type)).filter(e=>!e.matches(n.ignore.trim()||"_")).filter(e=>!e.hasAttribute("src")||!t.has(new u.URL(a.standardizeUrl(e.src)).href)||e.matches(n.reload.trim()||"_"));return(l=yield Promise.all((d=r,d.map(e=>f.fetch(e,c))))).reduce((e,t)=>t.bind(()=>e),l.reduce((e,r)=>e.bind(h.either).bind(([e,o])=>r.fmap(([e,r])=>f.evaluate(e,r,n.logger,t,Promise.all(o),h)).bind(t=>t.extract(t=>t.fmap(t=>i.tuple([e.concat([t]),o])),t=>s.Right(i.tuple([e,o.concat([t])]))))),s.Right([[],[]]))).fmap(([e,t])=>[e,Promise.all(t).then(e=>e.reduce((e,t)=>e.bind(e=>t.fmap(t=>e.concat([t]))),s.Right([])).extract())]);var l,d})},n._fetch=l,n._evaluate=d,n.escape=h},{"../../../../../lib/dom":127,"../../../../../lib/error":128,"../../../../../lib/url":131,"../../../../data/model/domain/url":90,"spica/either":10,"spica/tuple":78}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../event/router");function s(e,t,n={scrollToElement:e=>void e.scrollIntoView()}){const r=t.slice(1);if(0===r.length)return!1;const s=e.getElementById(r)||e.getElementsByName(r)[0];return!!s&&(n.scrollToElement(s),!0)}n.scroll=function(e,t,n,i={scrollToElement:e=>void e.scrollIntoView(),scrollToPosition:({top:e,left:t})=>void window.scrollTo(t,e),hash:s}){switch(e){case r.RouterEventType.click:if(i.hash(t,n.hash,i))return;return void i.scrollToPosition({top:0,left:0});case r.RouterEventType.submit:return void i.scrollToPosition({top:0,left:0});case r.RouterEventType.popstate:return void i.scrollToPosition(n.position());default:throw new TypeError(e)}},n._hash=s},{"../../../event/router":95}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/either"),s=e("spica/concat"),i=e("spica/tuple");n.sync=function(e,t,n={before:function(e,t,n){t.map(t=>e.ownerDocument.importNode(t.cloneNode(!0),!0)).forEach(t=>void e.insertBefore(t,n))},remove:function(e){e.remove()}}){return void e.forEach(([e,s])=>(n.before((r=s,r?r.parentElement:t),e.slice(-1).some(e=>!!s&&e.outerHTML===s.outerHTML)?e.slice(0,-1):e,s),s&&0===e.length?void n.remove(s):void 0));var r},n.pair=function(e,t,n){const o=(c=t,u=n,e.reduce((e,t)=>0===c.length?e.set(null,s.concat(e.get(null)||[],[t])):c.reduce((e,n)=>e.bind(e=>!e.has(n)&&u(t,n)?(e.set(n,s.concat(e.get(null)||[],[t])),e.delete(null),r.Left(e)):r.Right(e)),r.Right(e)).fmap(e=>e.set(null,s.concat(e.get(null)||[],[t]))).extract(e=>e),new Map));var c,u;return t.filter(e=>!o.has(e)).forEach(e=>void o.set(e,[])),[...o].map(([e,t])=>i.tuple([t,e]))}},{"spica/concat":8,"spica/either":10,"spica/tuple":78}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.title=function(e){e.dst.title=e.src.title}},{}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../event/router");function s(e,t){if(t.dest.href===t.orig.href)return!1;switch(e){case r.RouterEventType.click:case r.RouterEventType.submit:return!0;case r.RouterEventType.popstate:return!1;default:throw new TypeError(e)}}function i(e,t,n){switch(e){case r.RouterEventType.click:case r.RouterEventType.submit:return t.matches(n.trim()||"_");case r.RouterEventType.popstate:return!1;default:throw new TypeError(e)}}e("typed-dom").bind(document,"pjax:ready",()=>void window.history.replaceState(window.history.state,window.document.title)),n.url=function(e,t,n,r,o){switch(!0){case i(n,r,o):return void window.history.replaceState({},t,e.dest.href);case s(n,e):return void window.history.pushState({},t,e.dest.href);default:return}},n._isRegisterable=s,n._isReplaceable=i},{"../../../event/router":95,"typed-dom":81}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}(e("../../data/store/state"))},{"../../data/store/state":91}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../lib/error");n.InterfaceError=class extends r.PjaxError{constructor(e){super(`Interface: ${e}`)}}},{"../../../lib/error":128}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/supervisor"),s=e("typed-dom");n.ClickView=class{constructor(e,t,n,i){this.sv=new class extends r.Supervisor{},this.sv.register("",()=>(this.sv.events.exit.monitor([],s.delegate(e,t,"click",e=>{e.currentTarget instanceof HTMLAnchorElement&&"string"==typeof e.currentTarget.href&&n(e)})),new Promise(()=>void 0)),void 0),this.sv.cast("",void 0),i.register(()=>this.sv.terminate())}}},{"spica/supervisor":75,"typed-dom":81}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/supervisor"),s=e("typed-dom"),i=e("../../../data/model/domain/url"),o=e("../../service/state/url");n.NavigationView=class{constructor(e,t,n){this.sv=new class extends r.Supervisor{},this.sv.register("",()=>(this.sv.events.exit.monitor([],s.bind(e,"popstate",n=>{i.standardizeUrl(e.location.href)!==o.docurl.href&&t(n)})),new Promise(()=>void 0)),void 0),this.sv.cast("",void 0),n.register(()=>this.sv.terminate())}}},{"../../../data/model/domain/url":90,"../../service/state/url":126,"spica/supervisor":75,"typed-dom":81}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/supervisor"),s=e("typed-dom"),i=e("spica/throttle");n.ScrollView=class{constructor(e,t,n){this.sv=new class extends r.Supervisor{},this.sv.register("",()=>(this.sv.events.exit.monitor([],s.bind(e,"scroll",i.debounce(100,e=>!n.canceled&&void t(e)),{passive:!0})),new Promise(()=>void 0)),void 0),this.sv.cast("",void 0),n.register(()=>this.sv.terminate())}}},{"spica/supervisor":75,"spica/throttle":76,"typed-dom":81}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/supervisor"),s=e("typed-dom");n.SubmitView=class{constructor(e,t,n,i){this.sv=new class extends r.Supervisor{},this.sv.register("",()=>(this.sv.events.exit.monitor([],s.delegate(e,t,"submit",e=>{e.currentTarget instanceof HTMLFormElement&&n(e)})),new Promise(()=>void 0)),void 0),this.sv.cast("",void 0),i.register(()=>this.sv.terminate())}}},{"spica/supervisor":75,"typed-dom":81}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./router"),s=e("./state/process"),i=e("../../../lib/html"),o=e("spica/assign"),c=e("typed-dom");function u(e,t){const n=document.createElement("a");n.href=e,i.parse("").extract().body.appendChild(n),c.once(n,"click",t),n.click()}n.API=class{static assign(e,t,n={document:window.document,router:r.route}){u(e,e=>void n.router(new r.Config(t),new r.RouterEvent(e),s.process,n))}static replace(e,t,n={document:window.document,router:r.route}){u(e,e=>void n.router(new r.Config(o.extend({},t,{replace:"*"})),new r.RouterEvent(e),s.process,n))}}},{"../../../lib/html":129,"./router":121,"./state/process":123,"spica/assign":4,"typed-dom":81}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./api"),s=e("spica/supervisor"),i=e("spica/cancellation"),o=e("../../../lib/url"),c=e("../../data/model/domain/url"),u=e("../module/view/click"),a=e("../module/view/submit"),l=e("../module/view/navigation"),d=e("../module/view/scroll"),h=e("./router"),f=e("./state/url");e("./state/scroll-restoration");const p=e("./state/process"),m=e("../../application/store"),v=new class extends s.Supervisor{};n.GUI=class extends r.API{constructor(e,t={document:window.document,router:h.route}){super(),this.option=e,this.io=t;const n=new h.Config(this.option);v.register("",{init:e=>e,main:(e,r)=>(new u.ClickView(this.io.document,n.link,e=>void t.router(n,new h.RouterEvent(e),p.process,t),r),new a.SubmitView(this.io.document,n.form,e=>void t.router(n,new h.RouterEvent(e),p.process,t),r),new l.NavigationView(window,e=>void t.router(n,new h.RouterEvent(e),p.process,t),r),new d.ScrollView(window,()=>{new o.URL(c.standardizeUrl(window.location.href)).href===f.docurl.href&&m.savePosition()},r),new Promise(()=>void 0)),exit:(e,t)=>void t.cancel()},new i.Cancellation,new Error("Kill")),v.cast("",void 0)}assign(e){r.API.assign(e,this.option,this.io)}replace(e){r.API.replace(e,this.option,this.io)}}},{"../../../lib/url":131,"../../application/store":89,"../../data/model/domain/url":90,"../module/view/click":114,"../module/view/navigation":115,"../module/view/scroll":116,"../module/view/submit":117,"./api":118,"./router":121,"./state/process":123,"./state/scroll-restoration":125,"./state/url":126,"spica/cancellation":6,"spica/supervisor":75}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=document.createElement("div");window.addEventListener("pjax:fetch",()=>void document.documentElement.appendChild(r)),window.addEventListener("pjax:fetch",()=>r.style.width="5%"),window.addEventListener("pjax:unload",()=>r.style.width="80%"),document.addEventListener("pjax:ready",()=>r.style.width="90%"),window.addEventListener("pjax:load",()=>r.style.width="100%"),window.addEventListener("pjax:load",()=>void r.remove()),n.progressbar=function(e){r.setAttribute("style",e)}},{}],121:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,c)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const s=e("spica/cancellation"),i=e("typed-dom"),o=e("../../application/router");n.Config=o.Config,n.RouterEvent=o.RouterEvent,n.RouterEventSource=o.RouterEventSource;const c=e("./state/url"),u=e("../service/state/env"),a=e("./progressbar"),l=e("../data/error"),d=e("../../../lib/url"),h=e("../../data/model/domain/url"),f=e("../../application/store"),p=e("spica/maybe");function m(e,t,n){switch(n.type){case o.RouterEventType.click:return s(e)&&!function(e){const t=new d.URL(c.docurl.href);return t.origin===e.origin&&t.path===e.path&&""!==e.fragment}(e)&&!i(e)&&!n.source.hasAttribute("download")&&!((r=n.original).which>1||r.metaKey||r.ctrlKey||r.shiftKey||r.altKey)&&t.filter(n.source);case o.RouterEventType.submit:return s(e);case o.RouterEventType.popstate:return s(e)&&!i(e);default:return!1}var r;function s(e){return new d.URL(c.docurl.href).origin===e.origin}function i(e){const t=new d.URL(c.docurl.href);return t.origin===e.origin&&t.path===e.path&&t.fragment!==e.fragment}}i.bind(window,"pjax:unload",()=>window.history.scrollRestoration="auto",!0),n.route=function(e,t,n,v){switch(t.type){case o.RouterEventType.click:case o.RouterEventType.submit:f.savePosition();break;case o.RouterEventType.popstate:v.document.title=f.loadTitle()}p.Just(0).guard(m(new d.URL(t.request.url),e,t)).bind(()=>o.scope(e,(({orig:e,dest:t})=>({orig:e.pathname,dest:t.pathname}))(t.location))).fmap(e=>r(this,void 0,void 0,function*(){t.original.preventDefault(),n.cast("",new l.InterfaceError("Aborted."));const f=new s.Cancellation,p=n.register("",e=>(p(),f.cancel(e),new Promise(()=>void 0)),void 0),[m]=yield u.env;return window.history.scrollRestoration="manual",a.progressbar(e.progressbar),o.route(e,t,{process:f,scripts:m},v).then(e=>e.fmap(([e,t])=>r(this,void 0,void 0,function*(){return p(),c.docurl.sync(),e.filter(e=>e.hasAttribute("src")).forEach(e=>void m.add(new d.URL(h.standardizeUrl(e.src)).href)),void(yield t).filter(e=>e.hasAttribute("src")).forEach(e=>void m.add(new d.URL(h.standardizeUrl(e.src)).href))})).extract()).catch(n=>(p(),c.docurl.sync(),window.history.scrollRestoration="auto",!f.canceled||n instanceof Error&&"FatalError"===n.name?void e.fallback(i.currentTargets.get(t.original),n):void 0))})).extract(()=>r(this,void 0,void 0,function*(){switch(c.docurl.sync(),t.type){case o.RouterEventType.click:case o.RouterEventType.submit:return;case o.RouterEventType.popstate:return void e.fallback(t.source,new Error("Disabled."))}}))},n._validate=m},{"../../../lib/url":131,"../../application/router":88,"../../application/store":89,"../../data/model/domain/url":90,"../data/error":113,"../service/state/env":122,"./progressbar":120,"./state/url":126,"spica/cancellation":6,"spica/maybe":15,"typed-dom":81}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("./script");n.env=Promise.all([r.scripts,new Promise(setTimeout)])},{"./script":124}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/supervisor");n.process=new class extends r.Supervisor{}},{"spica/supervisor":75}],124:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../data/model/domain/url"),s=e("../../../../lib/url"),i=e("../../../../lib/dom"),o=e("typed-dom");n.scripts=new Set,o.bind(window,"pjax:unload",()=>void i.find(document,"script").filter(e=>e.hasAttribute("src")).forEach(e=>void n.scripts.add(new s.URL(r.standardizeUrl(e.src)).href)))},{"../../../../lib/dom":127,"../../../../lib/url":131,"../../../data/model/domain/url":90,"typed-dom":81}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("typed-dom").bind(window,"unload",()=>window.history.scrollRestoration="auto",!1)},{"typed-dom":81}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../../../data/model/domain/url"),s=e("typed-dom");let i=r.standardizeUrl(location.href);s.bind(window,"hashchange",()=>void n.docurl.sync()),n.docurl=new class{constructor(){this.sync=(()=>{i=r.standardizeUrl(location.href)})}get href(){return i}}},{"../../../data/model/domain/url":90,"typed-dom":81}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.find=function(e,t){return[...e.querySelectorAll(t||"_")]},n.serialize=function(e){return Array.from(e.elements).filter(e=>{if(e.disabled)return!1;switch(e.nodeName.toLowerCase()){case"input":switch(e.type.toLowerCase()){case"checkbox":case"radio":return e.checked;case"submit":case"button":case"image":case"reset":case"file":return!1;default:return!0}case"select":case"textarea":return!0;default:return!1}}).filter(e=>"string"==typeof e.name&&"string"==typeof e.value).map(e=>[encodeURIComponent(t(e.name)),encodeURIComponent(t(e.value))].join("=")).join("&");function t(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]?|[\uDC00-\uDFFF]/g,e=>2===e.length?e:"")}}},{}],128:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class r extends Error{constructor(e){super(`Pjax: ${e}`)}}n.PjaxError=r;n.FatalError=class extends r{constructor(e){super(`Pjax: Fatal: ${e}`),this.name="FatalError"}}},{}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("spica/maybe"),s=e("spica/either"),i=e("spica/tuple"),o=e("./dom");function c(e){u(e).forEach(([e,t])=>e.textContent=t.textContent)}function u(e){return o.find(e,"noscript").filter(e=>e.children.length>0).map(e=>{const t=e.cloneNode(!0);return t.textContent=e.innerHTML,i.tuple([e,t])})}n.parse=[function(e){const t=(new DOMParser).parseFromString(e,"text/html");return c(t),t},function(e){const t=window.document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),c(t),t}].reduce((e,t)=>e.bind(()=>!function(e){try{const t='\n<html lang="en" class="html">\n  <head>\n    <link href="/">\n    <title>&amp;</title>\n    <noscript><style>/**/</style></noscript>\n  </head>\n  <body>\n    <noscript>noscript</noscript>\n    <a href="/"></a>\n    <script>document.head.remove();<\/script>\n    <img src="abc">\n  </body>\n</html>\n',n=e(t);switch(!1){case n.URL&&n.URL.startsWith(`${window.location.protocol}//${window.location.host}`):case"&"===n.title:case!!n.querySelector('html.html[lang="en"]'):case!!n.querySelector("head > link").href:case!!n.querySelector("body > a").href:case!n.querySelector("head > noscript > *"):case"document.head.remove();"===n.querySelector("script").innerHTML:case n.querySelector("img").src.endsWith("abc"):case"<style>/**/</style>"===n.querySelector("head > noscript").textContent:case"noscript"===n.querySelector("body > noscript").textContent:throw void 0}return!0}catch(e){return!1}}(t)?e:s.Left(t)),s.Right(()=>r.Nothing)).extract(e=>t=>r.Just(e(t))),n._fixNoscript=u},{"./dom":127,"spica/either":10,"spica/maybe":15,"spica/tuple":78}],130:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("../layer/data/model/domain/url"),s=e("./url"),i=e("spica/sequence"),o=e("spica/uncurry"),c=e("spica/flip"),u=e("spica/cache");function a(e,t){const n=/\/|[^/]+\/?/g,r=/\/$/;return i.Sequence.zip(i.Sequence.from(l(e)),i.Sequence.cycle([t])).map(([e,t])=>[e.match(n)||[],e.match(r)?t.match(n)||[]:t.replace(r,"").match(n)||[]]).filter(([e,t])=>e.length<=t.length&&0===i.Sequence.zip(i.Sequence.from(e),i.Sequence.from(t)).dropWhile(o.uncurry(h)).take(1).extract().length).take(1).extract().length>0}function l(e){if(e.match(/\*\*|[\[\]]/))throw new Error(`Invalid pattern: ${e}`);return""===e?[e]:i.Sequence.from(e.match(/{[^{}]*}|.[^{]*/g)).map(e=>e.match(/^{[^{}]*}$/)?e.slice(1,-1).split(","):[e]).mapM(i.Sequence.from).map(e=>e.join("")).bind(t=>t===e?i.Sequence.from([t]):i.Sequence.from(l(t))).unique().extract()}n.router=function(e){return t=>{const{path:n,pathname:o}=new s.URL(r.standardizeUrl(t));return i.Sequence.from(Object.keys(e).filter(([e])=>"/"===e).sort().reverse()).filter(c.flip(a)(o)).map(t=>e[t]).take(1).extract().pop().call(e,n)}},n.compare=a,n._expand=l;const d=new u.Cache(100);function h(e,t){if("."===t[0]&&[..."?*"].includes(e[0]))return!1;const n=`${e}:${t}`;return d.has(n)?d.get(n):d.set(n,function e(t,n){const[r="",...s]=[...t];const[c="",...u]=[...n];switch(r){case"":return""===c;case"?":return""!==c&&"/"!==c&&e(s.join(""),u.join(""));case"*":return"/"===c?e(s.join(""),n):i.Sequence.zip(i.Sequence.cycle([s.join("")]),i.Sequence.from(n).tails().map(e=>e.join(""))).filter(o.uncurry(e)).take(1).extract().length>0;default:return c===r&&e(s.join(""),u.join(""))}}(function e(t){const n=t.replace(/\*(\?+)\*?/g,"$1*");return n===t?n:e(n)}(e),t))}n._match=h},{"../layer/data/model/domain/url":90,"./url":131,"spica/cache":5,"spica/flip":13,"spica/sequence":73,"spica/uncurry":80}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.URL=class{constructor(e){this.parser=document.createElement("a"),this.URL,this.parser.href=e||location.href,Object.freeze(this)}get href(){return this.parser.href}get origin(){return`${this.protocol}//${this.host}`}get domain(){return`${this.protocol}//${this.hostname}`}get scheme(){return this.parser.protocol.slice(0,-1)}get protocol(){return this.parser.protocol}get userinfo(){return this.parser.href.match(/[^:/?#]+:\/\/([^/?#]*)@|$/).pop()||""}get host(){return this.parser.host}get hostname(){return this.parser.hostname}get port(){return this.parser.port}get path(){return`${this.pathname}${this.query}`}get pathname(){return this.parser.pathname}get query(){return this.parser.search}get fragment(){return this.parser.href.replace(/^[^#]+/,"")}}},{}],"pjax-api":[function(e,t,n){arguments[4][81][0].apply(n,arguments)},{"./src/export":87,dup:81}]},{},[1,2,"pjax-api"]);